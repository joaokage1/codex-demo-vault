services:
  vault-backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    image: codex-demo-vault-backend:latest
    ports:
      - "8080:8080"
    volumes:
      - vault-data:/data

  vault-frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    image: codex-demo-vault-frontend:latest
    ports:
      - "3000:80"
    depends_on:
      - vault-backend

  vault-cli:
    build:
      context: .
      dockerfile: Dockerfile
    image: codex-demo-vault:latest
    working_dir: /work
    volumes:
      - ./:/work
    entrypoint: ["java", "-cp", "/app/vault.jar", "com.example.vault.cli.Main"]

volumes:
  vault-data:
